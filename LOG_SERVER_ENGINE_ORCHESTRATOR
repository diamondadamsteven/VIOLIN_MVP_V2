INFO:     Will watch for changes in these directories: ['C:\\Users\\diamo\\VIOLIN_MVP_V2']
INFO:     Uvicorn running on http://0.0.0.0:7070 (Press CTRL+C to quit)
INFO:     Started reloader process [32524] using WatchFiles
INFO:     Started server process [6312]
INFO:     Waiting for application startup.
ORCHESTRATOR MODULE IMPORTING - ABOUT TO RUN CLEANUP
SMART_CLEANUP FUNCTION CALLED
Smart cleanup starting - current PID: 6312
Waiting 3 seconds for other servers to start...
No conflicting processes found on port 7070
CLEANUP COMPLETED
Waiting 2 seconds for cleanup to complete...
STARTUP DELAY COMPLETED
ProcessPoolExecutor disabled - using optimized synchronous processing
STARTUP - === _startup() function called ===
STARTUP - DB_ENGINE_STARTUP: Connection pool configured - size=5, overflow=-4, timeout=30s
STARTUP - Pool details: checked_in=1, checked_out=0
STARTUP - DB_ENGINE_STARTUP: Table allowlist initialized successfully
STARTUP - === Pre-warming system resources ===
Starting resource pre-warming...
Pre-allocating memory pools...
Pre-allocated 3 buffers for 44100_100ms (4410 samples)
Pre-allocated 3 buffers for 22050_100ms (2205 samples)
Pre-allocated 3 buffers for 16000_100ms (1600 samples)
Pre-allocated 3 buffers for 44100_250ms (11025 samples)
Pre-allocated FFT buffers for size 1024
Pre-allocated FFT buffers for size 2048
Pre-allocated FFT buffers for size 4096
Pre-allocated FFT buffers for size 8192
Memory pools pre-allocated successfully
Warming CPU caches...
CPU caches warmed successfully
Initializing thread pools...
System has 12 CPU cores
Initializing 16 threads and 11 processes
Warming thread pools...
Thread pools warmed successfully
Thread pools initialized and warmed successfully
Pre-loading PYIN pitch detection engine...
PYIN engine pre-loaded successfully in 3.83 seconds
Generated 44 pitch estimates from dummy audio
Running aggressive PYIN engine warming with multiple audio samples...
Warming sample 1: 0.697s
Warming sample 2: 0.677s
Warming sample 3: 0.675s
PYIN engine final verification: 0.684s
PYIN engine still slow after warming: 0.684s
Pre-loading CREPE pitch detection engine...
Using device: cpu
Using tiny model with batch size 128 for cpu
Running first CREPE inference to load model...
CREPE engine pre-loaded successfully in 0.40 seconds
Generated 1 pitch estimates from dummy audio
Running aggressive CREPE engine warming with multiple audio samples...
  Warming sample 1: 0.302s
  Warming sample 2: 0.288s
  Warming sample 3: 0.297s
CREPE engine final verification: 0.262s
\u2713 CREPE engine warmed up (acceptable: 0.262s)
Pre-warming audio resampling operations...
Warming up 44.1kHz \u2192 22.05kHz resampling...
  44.1kHz\u219222.05kHz warm 1: 0.001s (22050 samples)
  44.1kHz\u219222.05kHz warm 2: 0.001s (22050 samples)
  44.1kHz\u219222.05kHz warm 3: 0.001s (22050 samples)
  44.1kHz\u219222.05kHz warm 4: 0.001s (22050 samples)
  44.1kHz\u219222.05kHz warm 5: 0.001s (22050 samples)
Warming up 22.05kHz \u2192 16kHz resampling...
  22.05kHz\u219216kHz warm 1: 0.001s (16000 samples)
  22.05kHz\u219216kHz warm 2: 0.001s (16000 samples)
  22.05kHz\u219216kHz warm 3: 0.001s (16000 samples)
  22.05kHz\u219216kHz warm 4: 0.001s (16000 samples)
  22.05kHz\u219216kHz warm 5: 0.001s (16000 samples)
Warming up 44.1kHz \u2192 16kHz resampling...
  44.1kHz\u219216kHz warm 1: 0.001s (16000 samples)
  44.1kHz\u219216kHz warm 2: 0.001s (16000 samples)
  44.1kHz\u219216kHz warm 3: 0.001s (16000 samples)
Final verification of resampling performance...
Final 44.1kHz\u219222.05kHz resampling: 0.001s
\u2713 Audio resampling is now cached and ready for fast processing
Resource pre-warming completed successfully
STARTUP - Resource pre-warming completed successfully
STARTUP - Resource monitoring started
STARTUP - === Checking for orphaned processes ===
PROCESS_MONITOR - Checking for orphaned processes...
PROCESS_MONITOR - Process cleanup check completed
STARTUP - Registered routes [{'type': 'Route', 'path': '/openapi.json', 'methods': ['HEAD', 'GET']}, {'type': 'Route', 'path': '/docs', 'methods': ['HEAD', 'GET']}, {'type': 'Route', 'path': '/docs/oauth2-redirect', 'methods': ['HEAD', 'GET']}, {'type': 'Route', 'path': '/redoc', 'methods': ['HEAD', 'GET']}, {'type': 'APIRoute', 'path': '/health', 'methods': ['GET']}, {'type': 'APIRoute', 'path': '/performance', 'methods': ['GET']}, {'type': 'APIRoute', 'path': '/resources', 'methods': ['GET']}, {'type': 'APIRoute', 'path': '/routes', 'methods': ['GET']}, {'type': 'APIWebSocketRoute', 'path': '/ws/stream', 'methods': []}, {'type': 'APIWebSocketRoute', 'path': '/ws/echo', 'methods': []}, {'type': 'APIWebSocketRoute', 'path': '/ws/stream_raw', 'methods': []}]
STARTUP - === Starting to create background scanner tasks ===
STARTUP - Creating task for PROCESS_MONITOR_HEARTBEAT
PROCESS_MONITOR - Registered task: heartbeat_monitor
STARTUP - Creating task for SERVER_ENGINE_LISTEN_3A_FOR_START
PROCESS_MONITOR - Registered task: scanner_3a
STARTUP - Creating task for SERVER_ENGINE_LISTEN_3B_FOR_FRAMES
PROCESS_MONITOR - Registered task: scanner_3b
STARTUP - Creating task for SERVER_ENGINE_LISTEN_3C_FOR_STOP
PROCESS_MONITOR - Registered task: scanner_3c
STARTUP - Creating task for SERVER_ENGINE_LISTEN_6_FOR_AUDIO_FRAMES_TO_PROCESS
PROCESS_MONITOR - Registered task: scanner_6
STARTUP - Creating task for SERVER_ENGINE_LISTEN_7_FOR_FINISHED_RECORDINGS
PROCESS_MONITOR - Registered task: scanner_7
STARTUP - === All background scanner tasks created and registered successfully ===
PROCESS_MONITOR - === Heartbeat monitor starting ===
SCANNER - === 3A_FOR_START scanner starting ===
SCANNER - === 3C_FOR_STOP scanner starting ===
SCANNER - === 7_FOR_FINISHED_RECORDINGS scanner starting ===
INFO:     Application startup complete.
INFO:     192.168.1.4:62277 - "GET /health HTTP/1.1" 200 OK
WS/ECHO - incoming {'peer': {'host': '192.168.1.4', 'port': 63582}}
INFO:     192.168.1.4:63582 - "WebSocket /ws/echo" [accepted]
INFO:     connection open
WS/STREAM - incoming {'peer': {'host': '192.168.1.4', 'port': 63583}}
INFO:     192.168.1.4:63583 - "WebSocket /ws/stream" [accepted]
INFO:     connection open
WS/ECHO - client disconnected {'peer': {'host': '192.168.1.4', 'port': 63582}}
INFO:     connection closed
SCANNER - 3A_FOR_START: found 1 START messages to process
SCANNER - 3A_FOR_START: processing START message 1
SCANNER - PROCESS_WEBSOCKET_START_MESSAGE: 1
STARTUP - Set COMPOSE_PLAY_OR_PRACTICE = Compose
STARTUP - Set AUDIO_STREAM_FILE_NAME = 202508292027312002.wav
STARTUP - Set COMPOSE_YN_RUN_FFT = N
SCANNER - PROCESS_THE_AUDIO_FRAME: 202508292027312002, 1
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 1, 'size1': array([ 3.1822000e-03,  7.6209921e-01,  5.6502163e-01, ...,
        2.0114021e-05, -1.0508919e-03, -3.0497140e-03],
      shape=(11025,), dtype=float32)}
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 1, 'size2': 11025}
CREPE - DEBUG_AUDIO {'audio_shape': (8000,), 'audio_length_ms': 500.0, 'expected_frames': 50}
CREPE - BEGIN {'rid': 202508292027312002, 'frame': 1, 'device': 'cpu', 'frames_approx': 50, 'audio_sha1': '65d016fa3b66', 'decoder': 'viterbi'}
CREPE - DEBUG_CREPE {'f0_length': 51, 'per_length': 51, 'actual_frames': 51}
CREPE - DB_INSERT_OK {'rid': 202508292027312002, 'frame': 1, 'row_count': 51, 'audio_sha1': '65d016fa3b66'}
SCANNER - PROCESS_THE_AUDIO_FRAME: 202508292027312002, 2
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 2, 'size1': array([-0.00205968, -0.00273678, -0.00210339, ..., -0.00726314,
       -0.00529994, -0.00403985], shape=(11025,), dtype=float32)}
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 2, 'size2': 11025}
CREPE - DEBUG_AUDIO {'audio_shape': (8000,), 'audio_length_ms': 500.0, 'expected_frames': 50}
CREPE - BEGIN {'rid': 202508292027312002, 'frame': 2, 'device': 'cpu', 'frames_approx': 50, 'audio_sha1': '234c62757236', 'decoder': 'viterbi'}
CREPE - DEBUG_CREPE {'f0_length': 51, 'per_length': 51, 'actual_frames': 51}
CREPE - DB_INSERT_OK {'rid': 202508292027312002, 'frame': 2, 'row_count': 51, 'audio_sha1': '234c62757236'}
SCANNER - PROCESS_THE_AUDIO_FRAME: 202508292027312002, 3
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 3, 'size1': array([-0.00258446, -0.00302578, -0.00359253, ...,  0.01988721,
        0.01662692,  0.0166239 ], shape=(11025,), dtype=float32)}
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 3, 'size2': 11025}
CREPE - DEBUG_AUDIO {'audio_shape': (8000,), 'audio_length_ms': 500.0, 'expected_frames': 50}
CREPE - BEGIN {'rid': 202508292027312002, 'frame': 3, 'device': 'cpu', 'frames_approx': 50, 'audio_sha1': '21792176fd7b', 'decoder': 'viterbi'}
CREPE - DEBUG_CREPE {'f0_length': 51, 'per_length': 51, 'actual_frames': 51}
CREPE - DB_INSERT_OK {'rid': 202508292027312002, 'frame': 3, 'row_count': 51, 'audio_sha1': '21792176fd7b'}
SCANNER - PROCESS_THE_AUDIO_FRAME: 202508292027312002, 4
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 4, 'size1': array([ 0.01071249,  0.01460939,  0.01303172, ..., -0.04234578,
       -0.04114464, -0.04609063], shape=(11025,), dtype=float32)}
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 4, 'size2': 11025}
CREPE - DEBUG_AUDIO {'audio_shape': (8000,), 'audio_length_ms': 500.0, 'expected_frames': 50}
CREPE - BEGIN {'rid': 202508292027312002, 'frame': 4, 'device': 'cpu', 'frames_approx': 50, 'audio_sha1': '2401035ce615', 'decoder': 'viterbi'}
CREPE - DEBUG_CREPE {'f0_length': 51, 'per_length': 51, 'actual_frames': 51}
CREPE - DB_INSERT_OK {'rid': 202508292027312002, 'frame': 4, 'row_count': 51, 'audio_sha1': '2401035ce615'}
SCANNER - PROCESS_THE_AUDIO_FRAME: 202508292027312002, 5
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 5, 'size1': array([-0.03465252, -0.05195482, -0.05619949, ..., -0.00078538,
        0.00133957,  0.00128174], shape=(11025,), dtype=float32)}
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 5, 'size2': 11025}
CREPE - DEBUG_AUDIO {'audio_shape': (8000,), 'audio_length_ms': 500.0, 'expected_frames': 50}
CREPE - BEGIN {'rid': 202508292027312002, 'frame': 5, 'device': 'cpu', 'frames_approx': 50, 'audio_sha1': '93c64c775445', 'decoder': 'viterbi'}
CREPE - DEBUG_CREPE {'f0_length': 51, 'per_length': 51, 'actual_frames': 51}
CREPE - DB_INSERT_OK {'rid': 202508292027312002, 'frame': 5, 'row_count': 51, 'audio_sha1': '93c64c775445'}
SCANNER - PROCESS_THE_AUDIO_FRAME: 202508292027312002, 6
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 6, 'size1': array([ 9.3963405e-04, -1.6838472e-05, -1.8339447e-03, ...,
        0.0000000e+00,  0.0000000e+00,  0.0000000e+00],
      shape=(11025,), dtype=float32)}
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 6, 'size2': 11025}
CREPE - DEBUG_AUDIO {'audio_shape': (8000,), 'audio_length_ms': 500.0, 'expected_frames': 50}
CREPE - BEGIN {'rid': 202508292027312002, 'frame': 6, 'device': 'cpu', 'frames_approx': 50, 'audio_sha1': 'ed42993e6019', 'decoder': 'viterbi'}
CREPE - DEBUG_CREPE {'f0_length': 51, 'per_length': 51, 'actual_frames': 51}
CREPE - DB_INSERT_OK {'rid': 202508292027312002, 'frame': 6, 'row_count': 51, 'audio_sha1': 'ed42993e6019'}
SCANNER - PROCESS_THE_AUDIO_FRAME: 202508292027312002, 7
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 7, 'size1': array([0.        , 0.        , 0.        , ..., 0.00637448, 0.00765144,
       0.00744796], shape=(11025,), dtype=float32)}
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 7, 'size2': 11025}
CREPE - DEBUG_AUDIO {'audio_shape': (8000,), 'audio_length_ms': 500.0, 'expected_frames': 50}
CREPE - BEGIN {'rid': 202508292027312002, 'frame': 7, 'device': 'cpu', 'frames_approx': 50, 'audio_sha1': 'c228ef1c4947', 'decoder': 'viterbi'}
CREPE - DEBUG_CREPE {'f0_length': 51, 'per_length': 51, 'actual_frames': 51}
CREPE - DB_INSERT_OK {'rid': 202508292027312002, 'frame': 7, 'row_count': 51, 'audio_sha1': 'c228ef1c4947'}
SCANNER - PROCESS_THE_AUDIO_FRAME: 202508292027312002, 8
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 8, 'size1': array([ 0.0012727 ,  0.00432065,  0.01220267, ..., -0.01757949,
       -0.01422883, -0.01351932], shape=(11025,), dtype=float32)}
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 8, 'size2': 11025}
CREPE - DEBUG_AUDIO {'audio_shape': (8000,), 'audio_length_ms': 500.0, 'expected_frames': 50}
CREPE - BEGIN {'rid': 202508292027312002, 'frame': 8, 'device': 'cpu', 'frames_approx': 50, 'audio_sha1': '96fd342eb288', 'decoder': 'viterbi'}
CREPE - DEBUG_CREPE {'f0_length': 51, 'per_length': 51, 'actual_frames': 51}
CREPE - DB_INSERT_OK {'rid': 202508292027312002, 'frame': 8, 'row_count': 51, 'audio_sha1': '96fd342eb288'}
SCANNER - PROCESS_THE_AUDIO_FRAME: 202508292027312002, 9
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 9, 'size1': array([-8.5753528e-03, -8.0861654e-03, -5.4925038e-03, ...,
       -1.6876720e-03, -9.1542082e-05,  2.4143856e-03],
      shape=(11025,), dtype=float32)}
STAGE6_FRAMES - PROCESS_THE_AUDIO_FRAME {'rid': 202508292027312002, 'frame': 9, 'size2': 11025}
CREPE - DEBUG_AUDIO {'audio_shape': (8000,), 'audio_length_ms': 500.0, 'expected_frames': 50}
CREPE - BEGIN {'rid': 202508292027312002, 'frame': 9, 'device': 'cpu', 'frames_approx': 50, 'audio_sha1': 'b55d9e07a4d3', 'decoder': 'viterbi'}
CREPE - DEBUG_CREPE {'f0_length': 51, 'per_length': 51, 'actual_frames': 51}
CREPE - DB_INSERT_OK {'rid': 202508292027312002, 'frame': 9, 'row_count': 51, 'audio_sha1': 'b55d9e07a4d3'}
INFO:     connection closed
SCANNER - 3C_FOR_STOP: found 1 STOP messages to process
SCANNER - 3C_FOR_STOP: processing STOP message 30
SCANNER - PROCESS_WEBSOCKET_STOP_MESSAGE: 30
